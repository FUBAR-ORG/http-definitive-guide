# `URL`과 리소스

- `URL`(`Uniform Resource Locator`)은 인터넷의 리소스를 가리키는 표준 이름.

> 전자정보 일부를 가리키고 그것이 어디에 있고 어떻게 접근할 수 있는지 알려줌.

## 인터넷의 리소스 탐색하기

- `URL`은 `URI`(`Uniform Resource Identifier`, 통합 자원 식별자)의 부분집합.
- `URI`는 `URL`과 `URN`으로 구성된 종합적인 개념.
- `URN`은 현재 그 리소스가 어디에 존재하든 상관없이 그 이름만으로 리소스를 식별.
- `URL`은 리소스가 어디 있는지 설명해서 리소스를 식별.
- `URL`은 `HTTP` 프로토콜 외에 다른 가용한 프로토콜 사용 가능.
- 대체로 `scheme://address/path` 구조로 이르어져 있음.

### `URL`이 있기 전 암흑의 시대

- `URL`은 애플리케이션이 리소스에 접근할 수 있는 방법을 제공.
- 웹 브라우저를 사용하면, `URL`을 더 영리하게 접근할 수 있고 다룰 수 있게 하여 온라인 세상을 단순화 시킴.

---

## `URL` 문법

- 대부분의 `URL` 스킴 문법

```
<스킴>://<사용자 이름>:<비밀번호>@<호스트>:<포트>/<경로>;<파라미터>?<질의>#<프레그먼트>
```

|  컴포넌트   |                                          설명                                          |      기본값      |
| :---------: | :------------------------------------------------------------------------------------: | :--------------: |
|    스킴     |       리소스를 가져오려면 어떤 프로토콜을 사용하여 서버에 접근해야 하는지 가리킴       |                  |
| 사용자 이름 |                         리소스에 접근할 때 필요한 사용자 이름                          |   `anonymous`    |
|  비밀번호   |                                사용자 비밀번호를 가리킴                                |                  |
|   호스트    |               리소스를 호스팅하는 서버의 호스트(도메인) 명이나 `IP` 주소               |                  |
|    포트     | 리소스를 호스팅하는 서버가 열어 놓은 포트 번호(접근하려는 포트 번호), 대부분 기본 포트 | 경우에 따라 다름 |
|    경로     |             서버 내 리소스의 위치를 가리킴, 문법은 서버와 스킴에 따라 다름             |                  |
|  파라미터   |                     특정 스킴들에서 입력 파라미터를 기술하는 용도                      |                  |
|    질의     |              스킴에서 애플리케이션(`DB` 등)에 파라미터를 전달하는데 쓰임               |                  |
| 프래그먼트  |            리소스의 조각이나 일부분을 가리키는 이름, 클라이언트에서만 사용             |                  |

### 스킴: 사용할 프로토콜

- 스킴은 주어진 리소스에 어떻게 접근하는지 알려주는 중요한 정보.
- `URL`을 해석하는 애플리케이션이 어떤 프로토콜을 사용하여 리소스를 요청해야 하는지 알려줌.
- 스킴 컴포넌트는 알파벳으로 시작해야 하고, `URL`의 나머지 부분들과 첫 번째 `':'` 문자로 구분하며, 대소문자를 가리지 않음.

```
http://www.joes-hardware.com
HTTP://www.joes-hardware.com
```

### 호스트와 포트

- 리소스를 찾기 위해 리소스를 호스팅하고 있는 장비와 그 장비 내에서 리소스에 접근할 수 있는 서버의 위치 정보가 필요.
- 호스트 컴포넌트는 접근하려고 하는 리소스를 가지고 있는 인터넷 상의 호스트 장비를 가리킴.

```
http://www.joes-hardware.com:80/index.html
http://161.58.228.45:80/index.html
```

- 포트 컴포넌트는 서버가 열어놓은 네트워크 포트를 가리킴.

> `TCP` 프로토콜을 사용하는 `HTTP`는 기본 포트로 `80` 사용.

### 사용자 이름과 비밀번호

- 서버는 자신이 가지고 있는 데이터에 접근을 허용하기 전에 사용자 이름과 비밀번호를 요구.

```
ftp://anonymous:my_passwd@ftp.prep.ai.mit.edu/pub/gnu
http://joe:hoespasswd@www.joes-hardware.com/sales_info.txt
```

### 경로

- 경로 컴포넌트는 리소스가 서버의 어디에 있는지 알려줌.
- 경로는 유닉스 파일 시스템의 파일 경로와 유사하며, 각 경로 조각은 자체만의 파라미터 컴포넌트를 가질 수 있음.

### 파라미터

- `URL`을 사용하는 애플리케이션이 리소스에 접근하려면 프로토콜 파라미터가 필요.
- 파라미터 컴포넌트는 애플리케이션이 서버에 정확한 요청을 하기 위해 필요한 입력 파라미터를 받는데 사용.
- `이름/값` 쌍의 리스트로 `';'` 문자로 구분하여 기술.

```
http://www.joes-hardware.com/hammers;sale=false/index.html;graphics=true
```

### 질의 문자열

- `DB` 같은 서비스들은 요청 받을 리소스 형식의 범위를 좁히기 위해서 질문이나 질의를 받을 수 있음.
- 질의 컴포넌트는 게이트웨이를 가리키는 `URL`의 경로 컴포넌트와 함께 전달.
  > 보통 게이트웨이는 다른 애플리케이션에 접근하려고 할 때 거치는 통로.
- `이름=값`의 쌍 형태로 `'&'` 문자로 구분하여 기술.

```
http://www.joes-hardware.com/inventory-check.cgi?item=12731
```

### 프래그먼트

- `HTML` 같은 리소스 형식들은 본래의 수준보다 더 작게 나뉠 수 있음.
- 프래그먼트 컴포넌트는 리소스의 특정 부분을 가리킬 수 있도록 리소스 내 조작을 가리킴.
- `URL`의 오른쪽에 `'#'`문자 뒤에 이어서 옴.
- `HTTP` 서버는 객체 일부가 아닌 전체만 다루기 때문에 클라이언트는 서버에 프래그먼트를 전달하지 않음.
- 브라우저가 서버로부터 전체 리소스를 내려받은 후, 프래그먼트를 사용하여 리소스의 일부 출력.

```
http://www.joes-hardware.com/tools.html#drills
```

---

## 단축 `URL`

- 웹 클라이언트는 몇몇 단축 `URL`을 인식하고 사용.

### 상대 `URL`

- `URL`은 절대 `URL`과 상대 `URL` 두 가지로 나뉨.
- 절대 `URL`은 리소스에 접근하는데 필요한 모든 정보.
- 상대 `URL`은 모든 정보를 담고 있지 않으며, 기저(`base`)라고 하는 `URL`을 사용함.
- 상대 `URL`은 `URL`을 짧게 표시하는 방식으로, 컴포넌트가 조합된 리소스의 기저 `URL`로부터 기술하지 않은 정보를 추측함.
- 상대 `URL`은 프래그먼트이거나 `URL` 일부이며, `URL`을 처리하는 브라우저 같은 애플리케이션은 상대 `URL`과 절대 `URL` 간에 상호 변환을 할 수 있어야 함.
- 상대 `URL`을 사용하면 리소스 집합(`HTML` 페이지 같은)을 쉽게 변경 가능.
  - 문서 집합의 위치를 변경하더라도 새로운 기저 `URL`에 의해 해석될 것이기 때문에 위치를 변경하더라도 잘 동작.
    > 마치 다른 서버에 있는 콘텐츠를 미러링 할 수 있게 허용하는 것과 유사.

#### 기저 `URL`

- 변환 과정의 첫 단계로, 기저 `URL`을 찾아 상대 `URL`의 기준으로 설정
- 기저 `URL` 찾는 과정.
  1. 리소스에서 명시적으로 제공
     - `HTML` 문서에서 기저 `URL`을 가리키는 `<BASE>` 태그로 기술 가능.
  2. 리소스를 포함하고 있는 기저 `URL`
     - 기저 `URL`이 명시되어 있지 않다면, 해당 리소스의 `URL` 사용.
  3. 기저 `URL`이 없는 경우
     - 보통 이련 경우는 절대 `URL`로만 이루어져 있거나, 불완전하거나 깨진 `URL`.

#### 상대 참조 해석하기

- 상대 `URL`과 기저 `URL`을 각각의 컴포넌트 조각으로 나누는 파싱, 분리, 즉, `URL` 분해 작업을 거쳐야 함.
- `URL` 분해 결과로 나온 컴포넌트들을 절대 경로 형태로 변환하는 알고리즘을 사용해 변환.

### `URL` 확장

- 브라우저들은 `URL`을 입력한 다음이나 입력하고 있는 동안에 자동으로 `URL`을 확장.

### 호스트 명 확장

- 단순한 휴리스틱만을 사용해서 입력한 호스트 명을 전체 호스트 명으로 확장할 수 있음.
- 단어를 찾지 못하면 몇 가지의 `URL`을 추가로 제시함.
- 사용자의 시간을 절약하고 혼란을 막아주지만, 프록시와 같은 `HTTP` 애플리케이션에 문제를 발생시킬 수도 있음.

### 히스토리 확장

- 과거에 사용자가 방문했던 `URL`의 기록을 저장해 놓는 것.
- `URL`에 입력된 글자들을 포함하는 완결된 형태의 `URL` 들을 선택하게 해줌.

> 프록시를 사용할 경우 `URL` 자동 확장 기능은 다르게 동작할 수 있음.

---

## 안전하지 않은 문자

- 모든 프로토콜이 데이터를 전송하기 위해서 서로 다른 장치를 가지고 있기 때문에, 어떤 인터넷 프로토콜을 통해서든 안전하게 전송될 수 있도록 `URL`을 설계하는 것이 중요.
- 안전한 전송이란, 정보가 유실될 위험 없이 `URL`을 전송할 수 있다는 것을 의미.
  - 전자 메일에 사용되는 `SMTP`(`Simple Mail Transfer Protocol`) 같은 프로토콜은 특정 문자를 제거할 수도 있는 전송 방식 사용.
- 문자가 제거되는 일은 피하고자 `URL`은 상대적으로 작고 일반적으로 안전한 알파벳 문자만 포함하도록 허락.
- 알파벳 외에 문자도 포함하려고 할 때 이스케이프라는 기능을 추가하여 안전하지 않은 문자를 안전한 문자로 인코딩.

### `URL` 문자 집합

- `US-ASCII`는 문자를 서식화하고 하드웨어 상에서 신호를 주고 받기 위해 7비트를 사용하여 영문 자판에 있는 키 대부분과 몇몇 출력되지 않는 제어 문자를 표현.
  - 만들어진지 오래된 문자 집합이기 때문에 수백 가지의 비 라틴계 언어들에 존재하는 변형된 문자까지 지원 불가.
- 뿐만 아니라 `URL`이 특정 이진 데이터를 포함해야 하는 경우도 발생.
- 이스케이프 문자열은 `US-ASCII`에서 사용 금지된 문자들로, 이동성과 완성도를 높여줌.

### 인코딩 체계

- 인코딩은 안전하지 않은 문자를 퍼센티지 기호(`%`)로 시작해, `ASCII` 코드로 표현되는 두 개의 16진수 숫자로 이루어진 "이스케이프" 문자로 바꿈.

### 문자 제한

- 몇몇 문자는 `URL` 내에서 특별한 의미로 예약이 되어 있으므로, 본래의 예약된 목적이 아닌 용도로 사용하려면 반드시 인코딩 해야 함.

|                     문자                      |                              선점 및 제한                              |
| :-------------------------------------------: | :--------------------------------------------------------------------: |
|                      `%`                      |            인코딩된 문자에 사용할 이스케이프 토큰으로 선점             |
|                `/`, `.`, `..`                 |                         경로 컴포넌트에서 선점                         |
|                      `#`                      |                     프래그먼트의 구획 문자로 선점                      |
|                      `?`                      |                     질의 문자열의 구획 문자로 선점                     |
|                      `;`                      |                      파라미터의 구획 문자로 선점                       |
|                      `:`                      |       스킴, 사용자 이름/비밀번호, 호스트/포트의 구획 문자로 선점       |
|                   `$`, `+`                    |                                  선점                                  |
|                 `@`, `&`, `=`                 |                     특정 스킴에서 의미가 있어 선점                     |
| `{`, `}`, `\|`, `\`, `·`, `~`, `[`, `]`, `\`` | 게이트웨이와 같은 여러 전송 에이전트에서 불안전하게 다루기 때문에 제한 |
|                 `<`, `>`, `"`                 |                             안전하지 않음.                             |
|              `0x00-0x1F`, `0x7F`              |                   제한. 출력할 수 없는 `ASCII` 문자                    |
|               `0x7F` 이상의 수                |                       제한. `ASCII` 문자가 아님.                       |

### 좀 더 알아보기

- 애플리케이션은 정해진 방식대로 구현해야 함.
- 어떤 애플리케이션에 어떤 `URL`을 보내든지, 그 전에 클라이언트 애플리케이션에서 안전하지 않거나 제한된 문자를 변환하는 것이 좋음.
- 어떤 문자를 인코딩해야 하는지 결정하는 데는 브라우저와 같이 사용자로부터 최초로 `URL`을 입력 받는 애플리케이션에서 하는 것이 가장 적절.
- 애플리케이션이 모든 문자를 인코딩하면, 오히려 오동작을 일으킬 수 있기 때문에 좋지 못함.
- `URL`을 해석하는 애플리케이션은 그것을 처리하기 전에 `URL`을 디코드해야 함.

---

## 스킴의 바다

|      스킴       |                                                                                    설명                                                                                    |
| :-------------: | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------: |
|     `http`      |                                                하이퍼텍스트 전송 프로토콜(`HyperText Transfer Protocol`). 기본 포트 값은 80                                                |
|     `https`     | `http`와 거의 같으나 커넥션의 양 끝단에서 암호화하기 위해 넷스케이프에서 개발한 보안 소켓 계층(`Secure Sockets Layer`, `SSL`)을 사용한다는 차이가 있음. 기본 포트 값은 443 |
|    `mailto`     |                                                                           이메일 주소를 가리킴.                                                                            |
|      `ftp`      |                 파일 전송 프로토콜(`File Transfer Protocol`)은 `FTP` 서버에 있는 파일을 내려 받거나 올리고, 디렉터리에 있는 콘텐츠 목록을 가져오는데 사용.                 |
| `rtsp`, `rtspu` |                  `RTSP URL`은 실시간 스트리밍 프로토콜(`Real Time Streaming Protocol`)을 통해서 읽을 수 있는 오디오 및 비디오와 같은 미디어 리소스 식별자                  |
|     `file`      |                                     주어진 호스트 기기(로컬 디스크, 네트워크 파일 시스템 등)에서 바로 접근할 수 있는 파일들을 나타냄.                                      |
|     `news`      |                                                                  특정 문서와 뉴스 그룹에 접근하는데 사용.                                                                  |
|    `telnet`     |                                                                      대화형 서비스에 접근하는데 사용                                                                       |

---

## 미래

- `URL`을 통해 세상에 존재하는 모든 객체에 이름을 지을 수 있고, 새로운 포맷을 쉽게 추가할 수 있으며, 인터넷 프로토콜 간에 공유할 수 있는 일관된 작명 규칙을 제공할 수 있게 됨.
- `URL`은 리소스가 옮겨지면 객체를 찾을 방법이 없어진다는 단점이 있음.
- 인터넷 기술 태스크 포스(`Internet Engineering Task Force`, `IEFT`)는 `URN`이라는 그 객체를 가리키는 실제 객체의 이름을 사용하는 `새로운 표준 작업에 착수.
- `URN`은 객체가 옮겨지더라도(웹 서버 내에서나 웹 서버 간 모두) 항상 객체를 가리킬 수 있는 이름을 제공.
- 지속 통합 자원 지시자(`Persistent uniform resource locators`, `PURL`)을 사용하면 `URL`로 `URN`의 기능을 제공 가능.
- `PURL`은 리소스의 실제 `URL` 목록을 관리하고 추적하는 리소스 위치 중개 서버를 두고, 해당 리소스를 우회적으로 제공.
- 클라이언트는 위치 할당자에게 리소스를 가져올 수 있는 영구적인 `URL`을 요청.

### 지금이 아니면, 언제?

- `URL`에서 `URN`으로 주소 체계를 바꾸는 것은 매우 큰 작업이므로 전환하기 위해 오랜 시간이 걸리므로 당분간 `URL`을 사용함.
- `URL`은 현재는 물론 가까운 미래에도 인터넷에 있는 리소스를 명명하는 방법이 될 것.
- 다만 한계를 가진 상태에서 그것을 해결할 수 있는 새로운 표준(아마도 `URN`) 같은 것들이 계속 나오고 적용될 것.