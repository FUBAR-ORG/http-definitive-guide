# 3장 HTTP 메시지

## 3-1. 메시지의 흐름

- HTTP 메시지는 HTTP 애플리케이션 간에 주고받은 데이터의 블록들
- 메시지의 내용과 의미를 설명하는 텍스트 메타 정보로 시작하고 그 다음에 선택적으로 데이터가 올 수 있다
- `인바운드, 아웃바운드, 업스트림, 다운스트림`은 메시지의 방향을 의미한다.

### 1. 메시지는 원 서버 방향을 인바운드로 하여 송신된다

- HTTP는 인바운드와 아웃바운드 라는 용어를 트랜잭션 방향을 표현하기 위해 사용한다.
- 메시지가 원 서버로 향하는 것은 인바운드
- 메시지가 사용자 에이전트로 돌아오는 것은 아웃바운드

### 2. 다운스트림으로 흐르는 메시지

- 요청 메시지냐 응답 메시지냐에 관계 없이 모든 메시지는 다운스트림으로 흐른다.
- 메시지의 발송자는 수신자의 업스트림이다.

## 3.2 메시지의 각 부분

HTTP 메시지는 단순한, 데이터의 구조화된 블록이다.  
메시지는 `시작줄, 헤더 블록, 본문` 이렇게 세 부분으로 이루어진다.

- 시작줄: 어떤 메시지인지 서술
- 헤더블록: 속성
- 본문: 데이터를 담음

시작줄과 헤더는 줄 단위로 분리된 아스키 문자열이다. 각 줄은 캐리지 리턴과 개행문자로 구성된 두 글자의 줄바꿈 문자열로 끝난다.

본문은 단순히 선택적인 데이터 덩어리이다. 시작줄, 헤더와 달리 본문은 텍스트나 이진 데이터를 포함할 수도 있고 비어있을 수도 있다.

### 1. 메시지 문법

모든 HTTP 메시지는 요청 메시지나 응답 메시지로 분류된다.

- 메서드

  - 클라이언트 측에서 서버가 리소스에 대해 수행해주길 바라는 동작.

- 요청 URL

  - 요청 대상이 되는 리소스를 지칭하는 완전한 URL 혹은 경로 구성요소

- 버전

  - 이 메시지에서 사용중인 HTTP 버전 `HTTP/<메이저>.<마이너>`

- 상태코드

  - 요청 중에 무엇이 일어났는지 설명하는 세자리 숫자.

- 사유구절

  - 숫자로 된 상태코드의 의미를 사람이 이해할 수 있게 설명해주는 짧은 문구

- 헤더들

  - 이름,콜론(:), 선택적인 공백, 값, CRLF가 순서대로 나타나는 0개 이상의 헤더들

- 엔터티 본문
  - 임이의 데이터 블록을 포함

### 2. 시작줄

- 요청줄

  - 요청 메시지는 서버에서 어떤 동작이 일어나야 하는지 설명해주는 메서드와 그 동작에 대한 대상을 지칭하는 요청 URL이 들어있다.

- 응답줄

  - 응답 메시지는 수행 결과에 대한 상태 정보와 결과 데이터를 클라이언트에게 돌려준다. 응답 메시지에 쓰인 HTTP 버전, 상태코드, 수행 상태 등이 들어있다.

- 메서드

  - 요청의 시작줄은 메서드로 시작하며 서버가 무엇을 해야하는지 말해준다.

- 상태코드

  - 클라이언트에게 무엇이 일어났는지 말해준다.

- 사유구절

  - 사유 구절은 응답 시작줄의 마지막 구성요소이다.

- 버전번호
  - 버전번호는 HTTP/x.y 형식으로 요청과 응답 메시지 양쪽 모두에 기술된다.

### 3. 헤더

- 헤더분류

  - 일반헤더: 요청과 응답 양쪽에 모두 나타날 수 있음
  - 요청헤더: 요청에 대한 부가 정보를 제공
  - 응답헤더: 응답에 대한 부가 정보를 제공
  - Entity 헤더: 본문 크기와 콘텐츠 혹은 리소스 그 자체를 서술
  - 확장 헤더: 명세에 정의되지 않은 새로운 헤더

- 헤더를 여러줄로 나누기

```
HTTP/1.0 200 OK
Content-Type: image/gif
Content-length: 8572
Server: Test Server
  Version 1.0
```

Server 헤더가 여러 줄로 값이 쪼개져 있다. 완전한 값은 Test Server Version 1.0이다.
여러 줄로 쪼개질 헤더의 앞에는 최소 하나의 스페이스 혹은 탭 문자가 와야 한다.

### 4. 엔터티 본문

- HTTP 메시지의 세 번째 부분은 선택적인 엔터티 본문이다.
- HTTP 메시지의 화물이라고 할 수 있다.
- 이미지, 비디오, HTML 문서, 소프트웨어 애플리케이션 등 여러 종류의 디지털 데이터를 실어나룰 수 있다.

### 5. 버전 0.9 메시지

- HTTP 프로토콜의 초기 버전이다.
- 요청은 그저 메서드와 요청 URL을 갖고있을 뿐이며, 응답은 오직 엔터티로만 되어있다.

## 3-3. 메서드

### 1. 안전한 메서드

GET과 HEAD 메서드는 안전하다고 할 수 있다. 이는 GET이나 HEAD 메서드를 사용하는 HTTP 요청의 결과로 서버에 어떤 작용도 없음을 의미한다.

안전한 메서드의 목적은, 서버에 어떤 영향을 줄 수 있는 **안전하지 않은 메서드가 사용될 때 사용자들에게 그 사실을 알려주는** HTTP 애플리케이션을 만들 수 있도록 하는 것이다.

### 2. GET

가장 흔히 쓰이며, 주로 서버에게 리소스를 달라고 요청하기 위해 쓰인다.

### 3. HEAD

GET 처럼 행동하지만, 서버는 응답으로 헤더만을 돌려준다. 클라이언트가 리소스를 가져올 필요없이 헤더만을 조사할 수 있도록 한다.

- 리소스를 가져오지 않고도 그에 대해 무엇인가를 알아낼 수 있다.
- 응답의 상태 코드를 통해, 개체가 존재하는지 확인할 수 있다.
- 헤더를 확인하여 리소스가 변경되었는지 검사할 수 있다.

### 4. PUT

PUT 메서드는 서버에 문서를 쓴다. 서버가 요청의 본문을 가지고 요청 URL의 이름대로 새 문서를 만들거나, 이미 URL이 존재한다면 본문을 사용해 교체하는 것이다.

### 5. POST

POST 메서드는 서버에 입력 데이터를 전송하기 위해 설계 되었다. 폼에 채워진 데이터는 서버로 전송되며, 서버는 이를 모아 필요로 하는곳에 보낸다.

### 6. TRACE

TRACE 메서드는 주로 진단을 위해 사용된다. 예를 들면 요청이 의도한 요청/응답 연쇄를 거쳐가는지 검사할 수 있다. 또한 프락시나 다른 애플리케이션들이 요청에 어떤 영향을 미치는지 확인해보고자 할 때도 좋은 도구다.

TRACE 요청은 어떠한 엔터티 본문도 보낼 수 없다. TRACE 응답의 엔터티 본문에는 서버가 받은 요청이 그대로 들어있다.

### 7. OPTIONS

웹 서버에게 여러 가지 종류의 지원 범위에 대해 물어본다. 서버에게 특정 리소스에 대해 어떤 메서드가 지원되는지 물어볼 수 있다

### 8. DELETE

서버에게 요청 URL로 지정한 리소스를 삭제할 것을 요청한다. 그러나 삭제가 수행되는 것을 보장하지 못한다. HTTP 명세는 서버가 클라이언트에게 알리지 않고 요청을 무시하는 것을 허용하기 때문이다.

### 9. 확장 메서드

HTTP는 필요에 따라 확장해도 문제가 없도록 설계되어 있으므로, 새로 기능을 추가해도 과거에 구현된 소프트웨어들의 오동작을 유발하지 않는다. 확장 메서드(그리고 대부분의 HTTP)를 다룰 때는 "엄격하게 보내고 관대하게 받아들여라" 라는 오랜 규칙에 따라는 것이 가장 좋다.

## 3-4. 상태코드

HTTP 상태코드는 크게 다섯가지로 나뉜다.

### 1. 100-199 정보성 상태코드

정보성 상태코드는 HTTP/1.1에서 도입되었다.

### 2. 2 200-299 성공 상태 코드

클라이언트가 요청을 보내면 그 요청은 대게 성공한다.

### 3. 300-399 리다이렉션 상태 코드

클라이언트가 관심있어 하는 리소스에 대해 다른 위치를 사용하라고 말해주거나 그 리소스의 내용 대신 다른 대안 응답을 제공한다. 클라이언트에게 리소스가 옮겨졌으며 어디서 찾을 수 있는지 리다이렉션 상태 코드와 Location 헤더를 보낼 수 있다.

### 4. 400-499 클라이언트 에러 상태 코드

### 5. 500-599 서버 에러 상태 코드

## 3-5 헤더.

- 일반 헤더: 클라이언트와 서버 양쪽 모두가 사용한다.

```
Date: Tue, 17 Nov 2020 23:13:00 GMT
```

- 요청 헤더: 요청 메시지를 위한 헤더이다. 서버에게 받고자 하는 데이터의 타입이 무엇인지와 같은 부가 정보를 제공한다.

```
Accept: */*
```

- 응답 헤더: 응답 메시지를 위한 헤더이다.

```
Server: Tiki-Hut/1.0
```

- 엔터티 헤더: 엔터티 본문에 대한 헤더이다. 엔터티 본문에 들어있는 데이터의 타입이 무엇인지 말해준다.
  아래의 Content-Type 헤더는 데이터가 iso-lation-1 문자집합으로 된 HTML 문서임을 알려준다.

```
Content-Type: text/html; charset=iso-latin-1
```

- 확장 헤더: 애플리케이션 개발자들에 의해 만들어졌지만 아직 승인된 HTTP 명세에는 추가되지 않은 비표준 헤더이다.
